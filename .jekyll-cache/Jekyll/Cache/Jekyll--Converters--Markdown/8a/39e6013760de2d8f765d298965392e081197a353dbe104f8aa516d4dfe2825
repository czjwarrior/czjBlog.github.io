I"<p>1ã€WKWebViewçš„ç®€å•åˆå§‹åŒ–</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- (WKWebView *)webView{
    if (_webView == nil) {
        _webView = [[WKWebView alloc] initWithFrame:self.sContentView.bounds];
        [_webView setAutoresizingMask:UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight];
        [_webView setNavigationDelegate:self];
        [_webView setUIDelegate:self];
        [_webView setMultipleTouchEnabled:YES];
        [_webView setAutoresizesSubviews:YES];
        [_webView.scrollView setAlwaysBounceVertical:YES];
        // è¿™è¡Œä»£ç å¯ä»¥æ˜¯ä¾§æ»‘è¿”å›webViewçš„ä¸Šä¸€çº§ï¼Œè€Œä¸æ˜¯æ ¹æ§åˆ¶å™¨ï¼ˆ*åªé’ˆå¯¹ä¾§æ»‘æœ‰æ•ˆï¼‰
        [_webView setAllowsBackForwardNavigationGestures:true];
    }
    return _webView;
}
</code></pre></div></div>

<p>è‡³äºå¦‚ä½•åŠ è½½webViewç”¨æ³•å’ŒUIWebViewleç±»ä¼¼ï¼Œè‡ªè¡Œç™¾åº¦ï¼Œä¸‹é¢ä»‹ç»rå¦‚ä½•è¿”å›ä¸Šä¸€å±‚ï¼Œä»£ç ç»“åˆReactiveCocoa,<a href="http://www.jianshu.com/p/87ef6720a096%20">ReactiveCocoaçš„ç®€å•ä½¿ç”¨</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@weakify(self)
    // è¿”å›æŒ‰é’®
    [self.baseView.navView addSubview:self.backBtn];
    [[self.backBtn rac_signalForControlEvents:UIControlEventTouchUpInside] subscribeNext:^(id x) {
        @strongify(self)
        if ([self.webView canGoBack]) {
            [self.webView goBack];
        } else {
            [self.viewModel.services popViewModelAnimated:YES];
        }
    }];
</code></pre></div></div>

<p>å¦‚æœè¦åšåˆ°ç±»ä¼¼äºå¾®ä¿¡é‡Œé¢çš„è¿”å›ä¸Šä¸€çº§å‡ºç°æœ‰å¥½çš„æç¤ºï¼Œå¯ä»¥é‡‡ç”¨ReactiveCocoaéå¸¸ç‰›é€¼çš„ç›‘å¬æœºåˆ¶ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// ç»‘å®šå…³é—­æŒ‰é’®
    RAC(self.baseView.popBtn, hidden) = [RACObserve(self.webView, canGoBack) map:^id(NSNumber *canGoBackNum) {
        @strongify(self)
        if (canGoBackNum.boolValue) {
            [self.backBtn setTitle:@"è¿”å›" forState:UIControlStateNormal];
        } else {
            [self.backBtn setTitle:@"" forState:UIControlStateNormal];
        }
        [self.backBtn sizeToFit];

        return @(!canGoBackNum.boolValue);
    }];
</code></pre></div></div>

<p>ç°åœ¨å¥½å¤šAPPéƒ½ä¼šåœ¨å¯¼èˆªæ ä¸‹æ–¹æ·»åŠ è¿›åº¦æ¡ï¼Œæé†’ç”¨æˆ·webViewçš„åŠ è½½è¿›åº¦ï¼Œè¿™åœ¨WKWebViewä¸­å®ç°èµ·æ¥ä¹Ÿéå¸¸ç®€å•ï¼Œåªéœ€è‡ªå®šä¹‰UIProgressViewå³å¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// ç›‘å¬è¿›åº¦
    [RACObserve(self.webView, estimatedProgress) subscribeNext:^(id x) {
        @strongify(self)

        [self.progressView setAlpha:1.0f];

        BOOL animated = self.webView.estimatedProgress &gt; self.progressView.progress;
        [self.progressView setProgress:self.webView.estimatedProgress animated:animated];

        if(self.webView.estimatedProgress &gt;= 1.0f) {
            [UIView animateWithDuration:0.3f delay:0.3f options:UIViewAnimationOptionCurveEaseOut animations:^{
                [self.progressView setAlpha:0.0f];

            } completion:^(BOOL finished) {
                [self.progressView setProgress:0.0f animated:NO];
            }];
        }
    }];
</code></pre></div></div>

:ET